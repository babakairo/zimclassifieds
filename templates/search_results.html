{% extends "base.html" %}

{% block title %}Search Results - ZimClassifieds{% endblock %}

{% block content %}
<h1 class="page-title">üîç Search Results</h1>

<div class="card" style="margin-bottom: 2rem;">
    <form method="get" action="/search">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
            <div class="form-group" style="margin: 0;">
                <label for="q">Search</label>
                <input type="text" id="q" name="q" value="{{ query }}" placeholder="Search...">
            </div>
            <div class="form-group" style="margin: 0;">
                <label for="category">Category</label>
                <select id="category" name="category">
                    <option value="">All Categories</option>
                    {% for cat in ['products', 'services', 'jobs', 'real_estate', 'relationships'] %}
                    <option value="{{ cat }}" {% if category == cat %}selected{% endif %}>{{ cat.replace('_', ' ').title() }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group" style="margin: 0;">
                <label for="city">City</label>
                <select id="city" name="city">
                    <option value="">All Cities</option>
                    {% for city in locations.keys()|sort %}
                    <option value="{{ city }}" {% if location_city == city %}selected{% endif %}>{{ city }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group" style="margin: 0;">
                <label for="price_min">Min Price</label>
                <input type="number" id="price_min" name="price_min" placeholder="ZWL">
            </div>
            <div class="form-group" style="margin: 0;">
                <label for="price_max">Max Price</label>
                <input type="number" id="price_max" name="price_max" placeholder="ZWL">
            </div>
            <div style="display: flex; align-items: flex-end;">
                <button type="submit" class="btn btn-primary" style="width: 100%; padding: 10px;">Filter</button>
            </div>
        </div>
    </form>
</div>

{% if listings %}
<p style="margin-bottom: 1rem; color: #666;">Found <strong>{{ listings|length }}</strong> listing{{ "s" if listings|length != 1 else "" }}</p>

<div class="grid">
    {% for listing in listings %}
    <a href="/listing/{{ listing.listing_id }}" class="listing-card">
        <div class="listing-image">
            {% if listing.category == 'products' %}
                üì¶
            {% elif listing.category == 'services' %}
                üîß
            {% elif listing.category == 'jobs' %}
                üíº
            {% elif listing.category == 'real_estate' %}
                üè†
            {% else %}
                üí≠
            {% endif %}
        </div>
        <div class="listing-content">
            <div class="listing-title">{{ listing.title }}</div>
            <div class="listing-category">{{ listing.subcategory }}</div>
            <div class="listing-location">üìç {{ listing.location_suburb }}, {{ listing.location_city }}</div>
            {% if listing.price %}
            <div class="listing-price">ZWL {{ "{:,.0f}".format(listing.price) }}</div>
            {% endif %}
            <div class="listing-time">{{ listing.created_at[:10] }}</div>
        </div>
    </a>
    {% endfor %}
</div>
{% else %}
<div class="alert alert-info">
    No listings found matching your search. Try different keywords or filters.
    <a href="/listing/new" class="btn btn-primary" style="margin-top: 1rem;">Post Your Own Ad</a>
</div>
{% endif %}
{% endblock %}
