{% extends "base.html" %}

{% block title %}Manage Products - {{ session.get('store_name', 'My Store') }}{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row mb-4">
        <div class="col">
            <h1 class="h3">Your Products</h1>
            <p class="text-muted">Manage and track all your product listings</p>
        </div>
        <div class="col-auto">
            <a href="{{ url_for('sellers.new_product') }}" class="btn btn-primary">
                <i class="bi bi-plus-circle"></i> Add New Product
            </a>
        </div>
    </div>
    
    {% if products %}
    <div class="card border-0 shadow-sm">
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Product Name</th>
                        <th>SKU</th>
                        <th>Price</th>
                        <th>Stock</th>
                        <th>Views</th>
                        <th>Rating</th>
                        <th>Status</th>
                        <th>Created</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for product in products %}
                    <tr>
                        <td>
                            <a href="{{ url_for('product_detail', product_id=product.product_id) }}" target="_blank">
                                {{ product.name }}
                            </a>
                        </td>
                        <td><code>{{ product.sku or 'N/A' }}</code></td>
                        <td>ZWL {{ "%.2f"|format(product.price) }}</td>
                        <td>
                            <span class="badge {% if product.stock_quantity > 20 %}bg-success{% elif product.stock_quantity > 5 %}bg-warning{% else %}bg-danger{% endif %}">
                                {{ product.stock_quantity }}
                            </span>
                        </td>
                        <td>{{ product.views }}</td>
                        <td>
                            {% if product.review_count > 0 %}
                            <span class="text-warning">‚òÖ {{ "%.1f"|format(product.rating) }}</span> ({{ product.review_count }})
                            {% else %}
                            <span class="text-muted">No reviews</span>
                            {% endif %}
                        </td>
                        <td>
                            <span class="badge bg-{% if product.status == 'active' %}success{% elif product.status == 'pending' %}warning{% else %}secondary{% endif %}">
                                {{ product.status|capitalize }}
                            </span>
                        </td>
                        <td>{{ product.created_at.strftime('%Y-%m-%d') }}</td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <a href="{{ url_for('sellers.edit_product', product_id=product.product_id) }}" class="btn btn-outline-primary" title="Edit">
                                    ‚úèÔ∏è
                                </a>
                                <button class="btn btn-outline-danger" onclick="deleteProduct('{{ product.product_id }}')" title="Delete">
                                    üóëÔ∏è
                                </button>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% else %}
    <div class="alert alert-info text-center py-5">
        <h5 class="mb-2">No Products Yet</h5>
        <p class="text-muted mb-3">Start selling by adding your first product</p>
        <a href="{{ url_for('sellers.new_product') }}" class="btn btn-primary">Add Your First Product</a>
    </div>
    {% endif %}
</div>

<script>
function deleteProduct(productId) {
    if (confirm('Are you sure you want to delete this product? This action cannot be undone.')) {
        fetch(`{{ url_for('sellers.delete_product', product_id='PLACEHOLDER') }}`.replace('PLACEHOLDER', productId), {
            method: 'POST',
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(r => r.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('Error: ' + data.message);
            }
        });
    }
}
</script>
{% endblock %}
